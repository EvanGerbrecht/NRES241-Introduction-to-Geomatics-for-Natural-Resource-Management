```{r echo=FALSE}
yml_content <- yaml::read_yaml("chapterauthors.yml")
author <- yml_content[["lab2shortname"]][["author"]]
```
# Mapping Sea Level Rise with Digitial Elevation Models {#SeaLevelRise}

Written by
```{r results='asis', echo=FALSE}
cat(author)
```

## Lab Overview {-}

Climate change is rapidly altering the stability of the Earth's cryosphere. Over the next century thawing glaciers and ice sheets are expected to result in sea level rise between X-Ym. This is a concern for many coastal environments and communities. 

In this lab you will use a digital elevation model (DEM) covering the metro Vancouver region to map areas at risk of flooding during an extreme weather event under current and future conditions, assuming 1.2m of sea level rise by the year 2100. In particular, we will focus on mapping the intersection of high risk areas with critical agricultural land in the Fraser Delta region.

In partnership with the Delta community, the CALP research group at UBC produced the following report on projected sea level rise and adaptation strategies for this region, which can be found here: https://www.fraserbasin.bc.ca/_Library/CCAQ_BCRAC/bcrac_delta_visioning-policy_4d.pdf.     

``` {r, echo=FALSE, fig.align = 'center'}
knitr::include_graphics('images/02-CALP.jpg')
```

Image from CALP (2012). 
------------------------------------------------------------------------

## Learning Objectives {-}

-   Lorem ipsum

-   Lorem ipsum 

-   Lorem ipsum 

------------------------------------------------------------------------

## Competencies in This Lab {-}

-   Lorem ipsum

-   Lorem ipsum

-   Lorem ipsum

------------------------------------------------------------------------

## Deliverables {-}

-   Lorem ipsum

-   Lorem ipsum

-   Lorem ipsum

------------------------------------------------------------------------

## Data {-}

-   Digital Elevation Model of the Fraser Valley

-   Polyline and polygon shapefiles of land area

-   Polygon shapefile of agricultural land from XXXX.

------------------------------------------------------------------------

## Task 1: Mapping current flood risk

Peak water levels during a storm with a return period of 200 years is expected to reach **2.96m** above sea level (CALP, 2012). We will start by modeling flooding for this scenario. Note that existing flood walls and dykes are built to withstand sea level rise of up to 3.5m and would mitigate flooding in an actual storm surge. For now, we will map flood risk assuming this infrastructure is not in place and there are no obstructions blocking the flow of water over the land.    

##### Q1. Explain what a **return period** is in terms of natural disasters. 

**Step 1:** First we will identify cells in the DEM that are below the projected high water line of 2.96m. Open the **FraserValleyDEM.tif** in ArcGIS Pro. Navigate to **Analysis > Tools > Reclassify (Spatial Analyst tools)**. 

``` {r, echo=FALSE, fig.align = 'center'}
knitr::include_graphics('images/02-reclassify.jpg')
```

Click the Classify button and in the pop-up window set the number of classes to 2 and the method to Manual Interval. Set the Upper value to 2.96 and hit OK. In the Output raster field give the new raster a descriptive name (ie DEM_reclass_2m) and save it to the default GDB. 

**HINT:Giving concise and descriptive names to your spatial data will make things easier to keep track of later on! Names should not include periods or spaces**

``` {r, echo=FALSE, fig.align = 'center'}
knitr::include_graphics('images/02-reclasstable.jpg')
```

Cells in the resulting raster with a value <2.96 will be assigned a new value of 1 and cells >2.96 will be assigned a new value of 2. 

##### Q2. What is the spatial resolution of the DEM? {-}

**Step 2:**Next, we will convert the reclassified raster into polygon features. Navigate to the **Raster to Polygon Tool (Conversion Tools)**. Set the input raster to the reclassified raster from the previous step and give the output polygon features a descriptive name (**flooded_2m**). Make sure the Simplify Polygons box is checked. 

Name the polygon features (flood_2m_polys) and save to the default GDB. 

##### Q3: What would happen if we did not simply the polygon features? Why might we want to produce simplified polygon features? 

**Step 3:**Open the attribute table for the polygon features. The **Gridcode** variable corresponds to the cell values from the input raster. In this case we are only interested in polygons representing low elevation cells. We will delete high elevation polygons by selecting features with gridcode = 2 

Click **Select by Attributes** and use the drop-down menus to generate the following expression:  

``` {r, echo=FALSE, fig.align = 'center'}
knitr::include_graphics('images/02-expression.jpg')
```

Click the **Delete Selection** button to delete the selected polygons. 

``` {r, echo=FALSE, fig.align = 'center'}
knitr::include_graphics('images/02-delete.jpg')
```

**Step 4:** Examine the resulting polygon shapefile. You will notice that there are lots of small isolated polygons, not adjacent to the coastline. We will remove these by intersecting the flooded areas features with a polyline representing the coastline. 

Open **Coastline.shp**. Navigate to **Map > Select by Location**. Set the Input Features to the flooded areas layer and the Selecting Features to the coastline layer. Set the Relationship to **Intersect**. **Make sure the Invert spatial relationship box is checked.** This will select polygons that do not intersect with the coast. Click Apply.

Delete the selected features. 

##### Q5: Describe how you would change the selection parameters if you wanted to select flooded areas that are further than 100m from the coastline?

You should now have polygon features that look like the following:

``` {r, echo=FALSE, fig.align = 'center'}
knitr::include_graphics('images/02-example.jpg')
```
**Step 5:**Zoom into the polygons. You will notice that even though we used simplified polygons, the edges are still quite jagged. Next, we will smooth these polygons for better visualization. 

First, we will reduce the jagged edges in the polygons. Navigate to the **Buffer** tool. Create a 30m buffer around the **flood_2m_polys** layer. Set the Dissolve type to **Disolve all output features to a single feature**. Name the output **flood_2m_30mBuffer** Click Run. 

###### Q6: Describe what happens if the buffer is not dissolved. Which would be better if you wanted to calculate the total flooded area in km2 and why?  

Next, we will clip the flooded polygons to align with the extent of the coastline. 

Load **FraserValley.shp**. Navigate to the **Clip** tool and set the **Input features** to the **flood_2m_30mBuffer** layer and the **Clip features** to the FraserValley.shp. Save the output as **flood_2m_30mBuffer_Clip**. Click Run. 

Turn on the **flooded_2m_30mBuffer_Clip** layer (turn off all others). Zoom in to Westham Island/Delta region and take a screenshot. **Include the screenshot in your final report**

**Step 6:** Repeat Steps 1-5, but with a high water line of 4.16m to simulate a storm surge with 1.2m of sea level rise.

---------------------------------------------------------------------

## Task 2: Intersect flooded areas with agriultural land in the delta

## Task 3: Create maps of flood zones